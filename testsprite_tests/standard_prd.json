{
  "meta": {
    "project": "Maraxo Medical Appointment Scheduling System",
    "date": "2026-01-15",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "Maraxo is a comprehensive Progressive Web Application (PWA) designed for Dra. Mara Flamini's dermatology practice. It facilitates seamless online appointment scheduling, management, and cancellation for patients while providing a secure and powerful administrative backend to manage schedules and appointments effectively.",
  "core_goals": [
    "Provide an intuitive and efficient online appointment booking system for patients with real-time availability and validation.",
    "Enable secure appointment cancellation with strict time-based policies and token-based verification.",
    "Offer a comprehensive admin dashboard for managing appointments, work schedules, and system configurations securely.",
    "Ensure robust patient management with automated duplicate prevention and validated data entry.",
    "Deliver PWA features including push notifications for appointment reminders, confirmations, and cancellations.",
    "Implement end-to-end input validation, authentication, and security best practices to protect sensitive data and ensure system integrity."
  ],
  "key_features": [
    "Patient Appointment Scheduling with dynamic visit, consult, practice types, health insurance selection, and 20-minute time slot generation.",
    "Real-time Available Times Management dynamically accounting for work schedules, unavailable days/times, and existing bookings.",
    "Secure Authentication and Authorization system for admin users with JWT tokens, password reset, and protected routes.",
    "Appointment Cancellation system utilizing secure JWT-based tokens, enforcing a 24-hour advance cancellation policy.",
    "Appointment Confirmation page providing detailed appointment info and cancellation instructions.",
    "Admin Dashboard with calendar interface, appointment management, and work schedule configurations.",
    "Patient Management including CRUD operations and phone number uniqueness validation.",
    "Push Notifications integration leveraging Web Push API with subscription management and various notification types.",
    "Comprehensive Client and Server-side Input Validation using Zod schemas and API validation.",
    "Robust API design with rate limiting and error handling for all endpoints.",
    "PWA features including manifest, service worker, offline capabilities, and install prompt."
  ],
  "user_flow_summary": [
    "Patients access the Home Page to learn about the practice and initiate appointment booking.",
    "Through a multi-step form on the Appointment Scheduling page, patients enter personal details, select visit type, consult/practice type, choose health insurance, date, and available time slot.",
    "Upon form submission, the system validates inputs, creates or finds the patient record, books the appointment, generates a cancellation token, and directs the patient to a Confirmation page.",
    "The Confirmation page displays appointment details, cancellation link, and important instructions.",
    "Patients can cancel appointments securely by accessing the Cancellation page via a tokenized link, verifying eligibility and confirming cancellation.",
    "Admin users authenticate via a secure login modal and gain access to the Admin Dashboard to view, manage appointments, work schedules, and unavailable times/days via intuitive calendar and accordion interfaces.",
    "Push notifications are sent to subscribed users for appointment reminders, confirmations, and cancellations.",
    "Throughout the application, validation errors, API failures, and loading states are handled gracefully with user-friendly messages and UI feedback."
  ],
  "validation_criteria": [
    "Form inputs adhere to Zod validation schemas with appropriate error messaging before enabling submission.",
    "API responses correctly enforce required fields, date/time formats, existence checks, and business rules.",
    "JWT-based authentication tokens are issued, stored securely, and validate user access on protected routes.",
    "Cancellation tokens must be verifiably linked to existing appointments and expire 12 hours before appointment time.",
    "Time slot generation dynamically excludes unavailable days, times, and existing booked or cancelled appointments.",
    "Admin functions require authenticated access and proper session management.",
    "Push notification subscriptions are saved uniquely and trigger notifications correctly as per event type.",
    "Rate limiting enforces request threshold to prevent API abuse without impacting user experience.",
    "UI components render correctly on all supported device sizes with responsive and accessible design.",
    "Error states present clear, localized messages and fallback behaviors that maintain app stability."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 15",
      "React 18",
      "PostgreSQL",
      "Tailwind CSS",
      "Shadcn UI",
      "Radix UI",
      "React Hook Form",
      "Zod",
      "NextAuth.js",
      "Redux Toolkit",
      "TanStack Query",
      "Web Push API",
      "PWA"
    ],
    "features": [
      {
        "name": "Appointment Scheduling",
        "description": "Core feature allowing patients to book appointments with date, time, visit type, consult type, practice type, and health insurance selection",
        "files": [
          "app/agendar-visita/page.tsx",
          "components/agendar-visita/AppointmentForm.tsx",
          "components/agendar-visita/AvailableTimesComponent.tsx",
          "components/agendar-visita/AvailableTimesComponentImproved.tsx",
          "components/agendar-visita/FooterRoot.tsx",
          "app/api/appointments/create/route.ts",
          "app/api/appointments/route.ts",
          "app/api/appointments/[id]/route.ts",
          "app/api/appointments/date/[date]/route.ts",
          "lib/actions.ts"
        ]
      },
      {
        "name": "Available Times Management",
        "description": "Dynamic time slot generation based on work schedule, existing appointments, and unavailable times",
        "files": [
          "app/api/available-times/route.ts",
          "app/api/available-times/[date]/route.ts",
          "components/agendar-visita/AvailableTimesComponent.tsx",
          "components/agendar-visita/AvailableTimesComponentImproved.tsx"
        ]
      },
      {
        "name": "Authentication & Authorization",
        "description": "Admin authentication system with JWT tokens, password reset, protected routes, and improved authentication flow that checks cached credentials before prompting for login",
        "files": [
          "app/api/auth/login/route.ts",
          "app/api/auth/logout/route.ts",
          "app/api/auth/forgot-password/route.ts",
          "app/api/auth/reset-password/route.ts",
          "app/api/auth/verify/route.ts",
          "lib/auth.ts",
          "lib/auth-edge.ts",
          "components/admin/LoginDialog.tsx",
          "components/admin/ProtectedRoute.tsx",
          "components/agendar-visita/FooterRoot.tsx",
          "lib/AuthContext.tsx",
          "middleware.ts"
        ]
      },
      {
        "name": "Patient Management",
        "description": "CRUD operations for patient records with phone number validation",
        "files": [
          "app/api/patients/route.ts",
          "app/api/patients/[id]/route.ts"
        ]
      },
      {
        "name": "Admin Panel",
        "description": "Admin interface for managing appointments, work schedules, and system configuration",
        "files": [
          "app/(admin)/admin/page.tsx",
          "app/(admin)/layout.tsx",
          "components/admin/AdminHeader.tsx",
          "components/admin/AdminFooter.tsx",
          "components/admin/AppointmentCard.tsx",
          "components/admin/AccordionComponent.tsx",
          "components/admin/AccordionItemList.tsx",
          "components/admin/DialogComponent.tsx",
          "components/admin/SelectTimeComponent.tsx"
        ]
      },
      {
        "name": "Appointment Cancellation",
        "description": "Secure cancellation system with token-based verification and 24-hour policy enforcement",
        "files": [
          "app/cancelar-cita/page.tsx",
          "app/api/cancel-appointment/route.ts",
          "app/api/cancel-appointment/verify/route.ts",
          "lib/cancellation-token.ts"
        ]
      },
      {
        "name": "Appointment Confirmation",
        "description": "Confirmation page displaying appointment details and cancellation information",
        "files": [
          "app/confirmation/page.tsx"
        ]
      },
      {
        "name": "Work Schedule Management",
        "description": "API endpoints for managing doctor's work schedule configuration",
        "files": [
          "app/api/work-schedule/route.ts",
          "app/api/work-schedule/[id]/route.ts"
        ]
      },
      {
        "name": "Unavailable Days Management",
        "description": "System for marking specific dates as unavailable (holidays, vacations, etc.)",
        "files": [
          "app/api/unavailable-days/route.ts",
          "app/api/unavailable-days/[date]/route.ts"
        ]
      },
      {
        "name": "Unavailable Times Management",
        "description": "System for marking specific time slots as unavailable",
        "files": [
          "app/api/unavailable-times/route.ts",
          "app/api/unavailable-times/[date]/route.ts"
        ]
      },
      {
        "name": "Health Insurance Management",
        "description": "API for retrieving health insurance options with pricing information",
        "files": [
          "app/api/health-insurance/route.ts",
          "data/obras-sociales.json"
        ]
      },
      {
        "name": "Visit Types Management",
        "description": "API for managing visit types (Consulta, Practica, etc.)",
        "files": [
          "app/api/visit-types/route.ts"
        ]
      },
      {
        "name": "Consult Types Management",
        "description": "API for managing consult types (Primera vez, Seguimiento)",
        "files": [
          "app/api/consult-types/route.ts"
        ]
      },
      {
        "name": "Push Notifications",
        "description": "Web Push API integration for sending notifications to subscribed users",
        "files": [
          "app/api/push/subscribe/route.ts",
          "app/api/push/unsubscribe/route.ts",
          "app/api/push/send/route.ts",
          "lib/push-notifications.ts"
        ]
      },
      {
        "name": "Input Validation",
        "description": "Client and server-side validation using Zod schemas",
        "files": [
          "lib/validation.ts"
        ]
      },
      {
        "name": "Rate Limiting",
        "description": "API rate limiting to prevent abuse and ensure system stability",
        "files": [
          "lib/rate-limit.ts"
        ]
      },
      {
        "name": "Database Operations",
        "description": "PostgreSQL database connection and query utilities",
        "files": [
          "lib/db.ts"
        ]
      },
      {
        "name": "UI Components",
        "description": "Reusable UI components built with Shadcn UI and Radix UI",
        "files": [
          "components/ui/button.tsx",
          "components/ui/input.tsx",
          "components/ui/label.tsx",
          "components/ui/select.tsx",
          "components/ui/calendar.tsx",
          "components/ui/dialog.tsx",
          "components/ui/alert.tsx",
          "components/ui/alert-dialog.tsx",
          "components/ui/card.tsx",
          "components/ui/form.tsx",
          "components/ui/popover.tsx",
          "components/ui/accordion.tsx",
          "components/ui/switch.tsx",
          "components/ui/skeleton.tsx",
          "components/ui/sonner.tsx"
        ]
      },
      {
        "name": "Password Reset",
        "description": "Password reset functionality with email verification",
        "files": [
          "app/reset-password/page.tsx",
          "app/api/auth/reset-password/route.ts",
          "app/api/auth/forgot-password/route.ts"
        ]
      },
      {
        "name": "Root Page",
        "description": "Main landing page of the application",
        "files": [
          "app/(root)/page.tsx",
          "app/layout.tsx"
        ]
      },
      {
        "name": "State Management",
        "description": "Redux store and user slice for global state management",
        "files": [
          "state/store.ts",
          "state/userInfo/userSlice.ts"
        ]
      },
      {
        "name": "Utilities",
        "description": "Helper functions and utilities used across the application",
        "files": [
          "lib/utils.ts",
          "lib/types.ts"
        ]
      }
    ]
  }
}
